<!DOCTYPE html>
<html>
<head>
    <title data-i18n="title">KCD2 Dice Optimizer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="sidebar">
        <h1 data-i18n="title">KCD2 Dice Optimizer</h1>
        
        <div class="section">
            <h2 data-i18n="selected_dice">Selected Dice</h2>
            <div id="dicePool"></div>
            <div class="remove-hint" data-i18n="remove_hint">Click × to remove dice</div>
        </div>
    </div>

    <div class="main-content">
        <div class="section">
            <h2 data-i18n="simulation">Simulation</h2>
            
            <div class="preset-controls">
                <select id="presetSelect"></select>
                <input type="text" id="presetName" placeholder="Preset name">
                <button onclick="savePreset(document.getElementById('presetName').value)" data-i18n="save_preset">Save</button>
                <button onclick="loadPreset(presetSelect.value)" data-i18n="load_preset">Load</button>
                <button onclick="deletePreset(presetSelect.value)" data-i18n="delete_preset">Delete</button>
            </div>

            <select id="dieSelect"></select>
            <button onclick="addDie()" data-i18n="add_die">Add Die</button>
            <button onclick="clearDice()" data-i18n="clear">Clear</button>
            <button onclick="startSimulation()" data-i18n="calculate">Calculate Combinations</button>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 0%"></div>
            </div>
        </div>

        <div id="results"></div>

        <div class="scoring-rules">
            <h3 data-i18n="how_we_choose">How do we choose the best combinations?</h3>
            <!-- Dynamic steps will be injected here -->
        </div>
    </div>

    <!-- Carga de idioma FIRST -->
    <script>
        const userLang = navigator.language || navigator.userLanguage;
        const langCode = userLang.split('-')[0];
        const lang = langCode === 'es' ? 'es' : 'en';
        document.write(`<script src="lang-${lang}.js"><\/script>`);
    </script>

    <!-- Resto de scripts -->
    <script src="diceData.js"></script>
    <script src="simulator.js"></script>

    <script>
        // Aplicar traducciones después de cargar todo
        function applyTranslations() {
            // Traducir elementos estáticos
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[key]) {
                    if (el.tagName === 'INPUT') {
                        el.placeholder = translations[key];
                    } else {
                        el.textContent = translations[key];
                    }
                }
            });

            // Traducir sección dinámica
            const scoringContainer = document.querySelector('.scoring-rules');
            if (scoringContainer) {
                scoringContainer.innerHTML = `
                    <h3>${translations.how_we_choose}</h3>
                    ${translations.simulation_steps.map(step => `
                        <div class="scoring-rule">${step}</div>
                    `).join('')}
                `;
            }

            // Actualizar selector de presets
            const presetSelect = document.getElementById('presetSelect');
            if (presetSelect) {
                presetSelect.innerHTML = `<option value="">${translations.select_preset}</option>`;
            }
        }

        // Inicialización completa
        document.addEventListener('DOMContentLoaded', () => {
            applyTranslations();
            populateDiceOptions();
            updatePresetSelector();
            updateFillButton();
        });
    </script>
</body>
</html>